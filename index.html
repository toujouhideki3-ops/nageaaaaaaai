<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¥ å¤ªé¼“ã®é”äºº ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒãƒƒãƒ ğŸ†</title>
    <style>
        /* --- CSS ã‚¹ã‚¿ã‚¤ãƒ« --- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f0f0;
            color: #333;
            text-align: center;
            padding: 20px;
        }

        .screen {
            background: #fff;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            margin: 0 auto;
            min-height: 400px;
            display: none;
            flex-direction: column;
            justify-content: center;
            
            /* --- ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨è¨­å®š --- */
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }

        /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¡¨ç¤ºçŠ¶æ…‹ */
        .screen.visible {
            opacity: 1;
            transform: translateY(0);
        }

        h1 { color: #e44d26; } 
        h2 { color: #333; }
        
        .rating-display {
            font-size: 1.5em;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 20px;
        }

        /* çµæœè¡¨ç¤ºã®è‰² */
        .win-text { color: #007bff; }
        .lose-text { color: #dc3545; }
        .draw-text { color: #ffc107; }

        button {
            background-color: #e44d26;
            color: white;
            border: none;
            padding: 15px 30px;
            margin: 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #d43b1a;
        }
        
        /* ç”³å‘Šãƒœã‚¿ãƒ³ã®ç‰¹æ®Šãªã‚¹ã‚¿ã‚¤ãƒ« */
        .result-button {
            padding: 20px 40px;
            font-size: 1.5em;
        }
        #btnWin { background-color: #28a745; }
        #btnLoss { background-color: #dc3545; }
        #btnDraw { background-color: #ffc107; color: #333; }

        .music-list {
            list-style: none;
            padding: 0;
            font-size: 1.1em;
            margin: 20px 0;
            text-align: left;
            width: 80%;
            margin: 20px auto;
        }

        .music-list li {
            background: #eee;
            margin: 5px 0;
            padding: 10px;
            border-radius: 5px;
        }
        
        .rating-table {
            width: 90%;
            margin: 20px auto;
            border-collapse: collapse;
        }
        
        .rating-table th, .rating-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
            font-size: 1.1em;
        }
        
        .rating-table th {
            background-color: #e44d26;
            color: white;
        }
        
        /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è©³ç´°ãƒ†ãƒ¼ãƒ–ãƒ« */
        .player-detail-table {
            width: 90%;
            margin: 15px auto;
            border-collapse: collapse;
            font-size: 1.2em;
        }
        .player-detail-table th, .player-detail-table td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px dashed #ccc;
        }
        .player-detail-table th {
            width: 30%;
            color: #e44d26;
        }
        
        /* ãƒ¬ãƒ¼ãƒˆå¤‰å‹•ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ */
        .delta-rate-change {
            font-weight: bold;
            transition: all 0.5s ease;
            display: inline-block;
        }
    </style>
</head>
<body>

    <div id="titleScreen" class="screen">
        <h1>ğŸ¥ å¤ªé¼“ã®é”äºº ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒãƒƒãƒ ğŸ†</h1>
        <div class="rating-display">
            ã‚ãªãŸã®ç¾åœ¨ã®ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°: <span id="playerRatingDisplay">1500</span>
        </div>
        <p>å¯¾æˆ¦ç›¸æ‰‹ã¨ã®ãƒªã‚¶ãƒ«ãƒˆäº¤æ›ã«åŸºã¥ãã€å‹æ•—ã‚’ç”³å‘Šã—ã¦ãã ã•ã„ã€‚</p>
        
        <button onclick="startMatch('online')">ãƒãƒƒãƒãƒ³ã‚°ã«å‚åŠ  (å¯¾äººã‚·ãƒŸãƒ¥)</button>
        <button onclick="startMatch('cpu')">CPUã¨ãƒãƒƒãƒãƒ³ã‚° (ãƒ†ã‚¹ãƒˆç”¨)</button>
    </div>

    <div id="matchResultScreen" class="screen">
        <h2>ğŸ‰ ãƒãƒƒãƒãƒ³ã‚°æˆç«‹ï¼</h2>
        
        <table class="player-detail-table">
            <tr>
                <th>ã‚ãªãŸ (Player)</th>
                <td id="myInfoDisplay"></td>
            </tr>
            <tr>
                <th>å¯¾æˆ¦ç›¸æ‰‹ (Rival)</th>
                <td id="opponentInfo"></td>
            </tr>
        </table>

        <h3>ä»Šæ—¥ã®èª²é¡Œæ›² (3æ›²)</h3>
        <ul id="selectedSongs" class="music-list">
            </ul>
        <button onclick="goToResultSubmission()">ãƒªã‚¶ãƒ«ãƒˆäº¤æ›ãƒ»çµæœç”³å‘Šã¸</button>
    </div>

    <div id="resultSubmissionScreen" class="screen">
        <h2>ğŸ—³ï¸ è©¦åˆçµæœã®ç”³å‘Š ğŸ—³ï¸</h2>
        <p>å¯¾æˆ¦ç›¸æ‰‹ã¨X (DM) ã§ãƒªã‚¶ãƒ«ãƒˆç”»åƒã‚’äº¤æ›ã—ã€**3æ›²åˆè¨ˆã®è‰¯ã®æ•°**ã§å‹æ•—ã‚’ç¢ºå®šã—ãŸå¾Œã€çµæœã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</p>
        
        <p id="opponentDisplayInSubmission" style="font-size: 1.3em; font-weight: bold; color: #1DA1F2; margin: 15px 0;">
            </p>
        
        <h3 style="color: #007bff; margin-top: 25px;">ç¢ºèª: ä»Šå›ã®èª²é¡Œæ›²</h3>
        <ul id="submissionSongs" class="music-list">
             </ul>

        <div style="margin-top: 30px;">
            <button id="btnWin" class="result-button" onclick="submitResult(1)">å‹åˆ© (Win)</button>
            <button id="btnLoss" class="result-button" onclick="submitResult(0)">æ•—åŒ— (Lose)</button>
            <button id="btnDraw" class="result-button" onclick="submitResult(0.5)">å¼•ãåˆ†ã‘ (Draw)</button>
        </div>
    </div>
    
    <div id="waitingScreen" class="screen" style="text-align: center;">
        <h2>â³ å¯¾æˆ¦ç›¸æ‰‹ã®ç”³å‘Šã‚’å¾…ã£ã¦ã„ã¾ã™...</h2>
        <p style="font-size: 1.2em;">å¯¾æˆ¦ç›¸æ‰‹ï¼ˆ<span style="color: #1DA1F2;"></span>ï¼‰ãŒçµæœã‚’ç”³å‘Šã™ã‚‹ã¾ã§ãŠå¾…ã¡ãã ã•ã„ã€‚</p>
        
        <div style="margin-top: 30px;">
            <p>ç”³å‘ŠãŒå®Œäº†ã™ã‚‹ã¨ã€è‡ªå‹•çš„ã«å‹æ•—çµæœç”»é¢ã«é·ç§»ã—ã¾ã™ã€‚</p>
            <button onclick="resetGame()">ã‚¿ã‚¤ãƒˆãƒ«ã«æˆ»ã‚‹ (å¼·åˆ¶ä¸­æ–­)</button>
        </div>
    </div>

    <div id="resultScreen" class="screen">
        <h2 id="resultHeading"></h2>
        <p>å¯¾æˆ¦çµæœãŒç”³å‘Šã•ã‚Œã¾ã—ãŸã€‚ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãŒå¤‰å‹•ã—ã¾ã™ã€‚</p>
        
        <table class="rating-table">
            <thead>
                <tr>
                    <th>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</th>
                    <th>æ—§R</th>
                    <th>æ–°R</th>
                    <th>å¢—æ¸›</th>
                    <th>äºˆæƒ³å‹ç‡</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>ã‚ãªãŸ</td>
                    <td id="playerOldR"></td>
                    <td id="playerNewR"></td>
                    <td class="delta-rate-change" id="playerDeltaR"></td>
                    <td id="playerExpected"></td>
                </tr>
                <tr>
                    <td>å¯¾æˆ¦ç›¸æ‰‹</td>
                    <td id="cpuOldR"></td>
                    <td id="cpuNewR"></td>
                    <td class="delta-rate-change" id="cpuDeltaR"></td>
                    <td id="cpuExpected"></td>
                </tr>
            </tbody>
        </table>

        <button onclick="resetGame()">ã‚¿ã‚¤ãƒˆãƒ«ã«æˆ»ã‚‹</button>
    </div>


    <script>
        // --- è¨­å®šå€¤ã¨åˆæœŸãƒ‡ãƒ¼ã‚¿ ---
        const SONG_POOL = [
            "Infinite Rebellion", "å½ï¼ˆè£ï¼‰", "CRUXNAUT", "The Future of the å¤ªé¼“ãƒ‰ãƒ©ãƒ ï¼ˆè£ï¼‰", 
            "ç¥ç«œ ï½Shinryuï½ï¼ˆè£ï¼‰", "æ†æ‚ªã¨é†œæ‚ªã®èŠ±æŸï¼ˆè£ï¼‰", "ãƒ€ãƒ¼ã‚¯ãƒ»ã‚¨ã‚¯ã‚¹ãƒ»ãƒã‚­ãƒŠâ™¡", 
            "ç¬¬å…­å¤©é­”ç‹ï¼ˆè¡¨ï¼‰", "ç¬¬å…­å¤©é­”ç‹ï¼ˆè£ï¼‰", "ãƒ€ãƒ³ã‚¬ãƒ³ãƒãƒ¼ãƒ„ï¼ˆè£ï¼‰", "Destination 2F29", 
            "ãƒ‰ãƒ³ã‚«ãƒ2000", "23æ™‚54åˆ†ã€é™½ã®æ—…è·¯ã¸ã®ãƒ—ãƒ¬ãƒªãƒ¥ãƒ¼ãƒ‰ï¼ˆè£ï¼‰", "Vixtoryï¼ˆè£ï¼‰", 
            "vs.VIGVANGSï¼ˆè£ï¼‰", "poxeiâ™¦DOON", "å¹½ç„ãƒä¹±"
        ];
        const K_FACTOR = 32;
        const INITIAL_RATING = 1500;
        const SIMULATION_DELAY_MS = 5000; // CPUã®ç”³å‘Šé…å»¶æ™‚é–“ (5ç§’)

        // --- ã‚²ãƒ¼ãƒ ã‚¹ãƒ†ãƒ¼ãƒˆ ---
        let playerRating = INITIAL_RATING;
        let cpuRating = INITIAL_RATING;
        let opponentXId = '';
        const PLAYER_ID = "@Taiko_test"; 
        let playerReportedResult = null;
        let opponentReportedResult = null;

        // --- ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•° ---

        // ç”»é¢è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ (ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ã)
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(el => {
                el.classList.remove('visible');
                el.style.display = 'none'; 
            });
            const targetScreen = document.getElementById(screenId);
            targetScreen.style.display = 'flex';
            
            setTimeout(() => {
                targetScreen.classList.add('visible'); 
            }, 10); 
        }

        // ç°¡æ˜“çš„ãªãƒ©ãƒ³ãƒ€ãƒ IDç”Ÿæˆé–¢æ•°
        function generateRandomXId(isCPU) {
            if (isCPU) {
                const cpuNames = ["TaikoRival", "R_Mash", "Donbot", "KatsuKing"];
                const suffix = Math.floor(Math.random() * 900) + 100;
                return `@${cpuNames[Math.floor(Math.random() * cpuNames.length)]}_${suffix}`;
            }
            return "@AnonPlayer_" + Math.random().toString(36).substring(2, 8);
        }

        // ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ã®è¡¨ç¤ºã¨ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®æ›´æ–°
        function resetGame() {
            // ã‚¹ãƒ†ãƒ¼ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ
            playerReportedResult = null;
            opponentReportedResult = null;

            document.getElementById('playerRatingDisplay').textContent = Math.round(playerRating);
            showScreen('titleScreen');
        }

        // 3æ›²ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«é¸æ›²ã™ã‚‹
        function selectRandomSongs(count) {
            const shuffled = [...SONG_POOL].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count);
        }

        // --- Eloãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ ---
        
        function calculateExpectedScore(Ra, Rb) {
            return 1.0 / (1.0 + Math.pow(10, (Rb - Ra) / 400));
        }

        function updateRating(R, E, S, K) {
            return R + K * (S - E);
        }

        // --- ã‚²ãƒ¼ãƒ ãƒ•ãƒ­ãƒ¼é–¢æ•° ---

        // ãƒãƒƒãƒãƒ³ã‚°é–‹å§‹å‡¦ç†
        function startMatch(mode) {
            cpuRating = INITIAL_RATING + Math.floor(Math.random() * 200) - 100; 
            
            const isCPU = (mode === 'cpu');
            opponentXId = generateRandomXId(isCPU);
            const opponentType = isCPU ? 'CPU (ãƒ†ã‚¹ãƒˆç”¨)' : 'åŒ¿åãƒ¦ãƒ¼ã‚¶ãƒ¼';

            // è‡ªåˆ†ã¨ç›¸æ‰‹ã®æƒ…å ±ã‚’è¡¨ç¤º (Match Result Screen)
            document.getElementById('myInfoDisplay').innerHTML = 
                `ID: **${PLAYER_ID}**<br>R: ${Math.round(playerRating)}`;
            document.getElementById('opponentInfo').innerHTML = 
                `ID: **${opponentXId}**<br>R: ${Math.round(cpuRating)}`;

            selectedSongs = selectRandomSongs(3);
            
            const songListElement = document.getElementById('selectedSongs');
            songListElement.innerHTML = '';
            
            selectedSongs.forEach(song => {
                const li = document.createElement('li');
                li.textContent = song;
                songListElement.appendChild(li);
            });

            showScreen('matchResultScreen');
        }

        // çµæœç”³å‘Šç”»é¢ã¸é·ç§»
        function goToResultSubmission() {
            const submissionList = document.getElementById('submissionSongs');
            submissionList.innerHTML = '';
            
            selectedSongs.forEach(song => {
                const li = document.createElement('li');
                li.textContent = song;
                submissionList.appendChild(li);
            });
            
            // ç›¸æ‰‹ã®IDã‚’è¡¨ç¤º
            document.getElementById('opponentDisplayInSubmission').textContent = 
                `å¯¾æˆ¦ç›¸æ‰‹: ${opponentXId}`;
            
            showScreen('resultSubmissionScreen');
        }

        /**
         * ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒçµæœã‚’ç”³å‘Šã™ã‚‹éš›ã®å‡¦ç†
         * @param {number} pResult ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç”³å‘Šçµæœ (1:å‹, 0:è² , 0.5:åˆ†)
         */
        function submitResult(pResult) {
            let resultAction = "";
            if (pResult === 1) resultAction = "å‹åˆ©";
            else if (pResult === 0) resultAction = "æ•—åŒ—";
            else resultAction = "å¼•ãåˆ†ã‘";

            // ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°
            if (!confirm(`å¯¾æˆ¦çµæœã‚’ã€Œ${resultAction}ã€ã§ç”³å‘Šã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ\n(å¯¾æˆ¦ç›¸æ‰‹ID: ${opponentXId})`)) {
                return;
            }

            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç”³å‘Šã‚’è¨˜éŒ²
            playerReportedResult = pResult;

            // ç›¸æ‰‹å¾…ã¡ç”»é¢ã¸é·ç§»
            document.querySelector('#waitingScreen p span').textContent = opponentXId;
            showScreen('waitingScreen');

            // CPUã®ç”³å‘Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹å§‹
            simulateCpuSubmission(pResult);
        }
        
        /**
         * CPUãŒçµæœã‚’ç”³å‘Šã™ã‚‹ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
         * @param {number} playerResult ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç”³å‘Šçµæœ (1, 0, 0.5)
         */
        function simulateCpuSubmission(playerResult) {
            setTimeout(() => {
                let cpuResult;

                // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç”³å‘Šã«å¯¾ã™ã‚‹ã€Œæ­£å¸¸ãªã€CPUå´ã®ç”³å‘Š
                if (playerResult === 1) {
                    cpuResult = 0; // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å‹åˆ© -> CPUæ•—åŒ—
                } else if (playerResult === 0) {
                    cpuResult = 1; // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ•—åŒ— -> CPUå‹åˆ©
                } else {
                    cpuResult = 0.5; // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å¼•ãåˆ†ã‘ -> CPUå¼•ãåˆ†ã‘
                }
                
                opponentReportedResult = cpuResult;

                // ä¸¡è€…ã®çµæœã‚’ç…§åˆã—ã€å‹æ•—åˆ¤å®šã¸é€²ã‚€
                checkResultsAndCalculate();

            }, SIMULATION_DELAY_MS);
        }

        /**
         * ä¸¡è€…ã®ç”³å‘Šçµæœã‚’ç…§åˆã—ã€ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨ˆç®—ã‚’è¡Œã†
         */
        function checkResultsAndCalculate() {
            // ä¸¡è€…ã®ç”³å‘ŠãŒæƒã£ã¦ã„ã‚‹ã‹ç¢ºèª
            if (playerReportedResult === null || opponentReportedResult === null) {
                alert("ã‚¨ãƒ©ãƒ¼: ä¸¡è€…ã®ç”³å‘ŠãŒæƒã£ã¦ã„ã¾ã›ã‚“ã€‚");
                resetGame();
                return;
            }

            // --- ç”³å‘Šå†…å®¹ã®ç…§åˆãƒã‚§ãƒƒã‚¯ ---
            // æ­£å¸¸ãªç”³å‘Šã§ã‚ã‚Œã°ã€åˆè¨ˆã¯ 1.0 ã«ãªã‚‹ (1+0, 0.5+0.5, 0+1)
            const resultSum = playerReportedResult + opponentReportedResult;

            if (resultSum !== 1.0) {
                 // ä¸¡è€…å‹ã¡ (2.0) ã‚„ ä¸¡è€…è² ã‘ (0.0) ãªã©ã€çŸ›ç›¾ãŒç”Ÿã˜ãŸå ´åˆ
                 alert(`âš ï¸ ã€ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ã€‘ç”³å‘Šå†…å®¹ãŒçŸ›ç›¾ã—ã¦ã„ã¾ã™ (åˆè¨ˆ: ${resultSum.toFixed(1)})ã€‚\n\næœ¬æ¥ã€ã“ã®ç”³å‘Šå†…å®¹ã¯è¨˜éŒ²ã•ã‚Œã€ç®¡ç†è€…ã®èª¿æŸ»å¾…ã¡ã¨ãªã‚Šã¾ã™ã€‚\nä»Šå›ã¯ãƒ†ã‚¹ãƒˆã®ãŸã‚ã‚¿ã‚¤ãƒˆãƒ«ã«æˆ»ã‚Šã¾ã™ã€‚`);
                 resetGame();
                 return;
            }
            
            // æ­£å¸¸ãªç”³å‘Šã§ã‚ã‚Œã°ã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç”³å‘Šå€¤ãŒæœ€çµ‚çµæœã¨ãªã‚‹
            let finalPlayerResult = playerReportedResult; 
            let resultText = "";
            let resultClass = "";

            if (finalPlayerResult === 1) {
                resultText = "ğŸ† å‹åˆ©ï¼ ğŸ†";
                resultClass = "win-text";
            } else if (finalPlayerResult === 0) {
                resultText = "æ•—åŒ—...";
                resultClass = "lose-text";
            } else {
                resultText = "å¼•ãåˆ†ã‘ï¼";
                resultClass = "draw-text";
            }

            calculateAndDisplayRating(finalPlayerResult, resultText, resultClass);
        }
        
        // ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨ˆç®—ã¨çµæœè¡¨ç¤º
        function calculateAndDisplayRating(pResult, rText, rClass) {
            
            const expectedPlayerScore = calculateExpectedScore(playerRating, cpuRating);
            const expectedCpuScore = calculateExpectedScore(cpuRating, playerRating); 

            const oldPlayerR = playerRating;
            const oldCpuR = cpuRating;
            
            const newPlayerR = updateRating(oldPlayerR, expectedPlayerScore, pResult, K_FACTOR);
            const newCpuR = updateRating(oldCpuR, expectedCpuScore, 1 - pResult, K_FACTOR);
            
            const deltaPlayerR = Math.round(newPlayerR - oldPlayerR);
            const deltaCpuR = Math.round(newCpuR - oldCpuR);
            
            playerRating = newPlayerR;
            cpuRating = newCpuR;
            
            // 3. çµæœç”»é¢ã«è¡¨ç¤º
            const resultHeading = document.getElementById('resultHeading');
            resultHeading.textContent = rText;
            resultHeading.className = rClass;

            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ãŸã‚ã®åˆæœŸå€¤è¨­å®š
            document.getElementById('playerOldR').textContent = Math.round(oldPlayerR);
            document.getElementById('playerNewR').textContent = Math.round(oldPlayerR);
            document.getElementById('playerDeltaR').textContent = `è¨ˆç®—ä¸­...`;
            document.getElementById('playerExpected').textContent = `${(expectedPlayerScore * 100).toFixed(1)}%`;
            document.getElementById('playerDeltaR').style.color = 'black';

            document.getElementById('cpuOldR').textContent = Math.round(oldCpuR);
            document.getElementById('cpuNewR').textContent = Math.round(oldCpuR);
            document.getElementById('cpuDeltaR').textContent = `è¨ˆç®—ä¸­...`;
            document.getElementById('cpuExpected').textContent = `${(expectedCpuScore * 100).toFixed(1)}%`;
            document.getElementById('cpuDeltaR').style.color = 'black';

            showScreen('resultScreen');

            // --- ãƒ¬ãƒ¼ãƒˆå¤‰å‹•ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ ---
            setTimeout(() => {
                document.getElementById('playerNewR').textContent = Math.round(newPlayerR);
                document.getElementById('playerDeltaR').textContent = `${deltaPlayerR > 0 ? '+' : ''}${deltaPlayerR}`;
                document.getElementById('playerDeltaR').style.color = deltaPlayerR > 0 ? 'blue' : (deltaPlayerR < 0 ? 'red' : 'black');
                
                document.getElementById('cpuNewR').textContent = Math.round(newCpuR);
                document.getElementById('cpuDeltaR').textContent = `${deltaCpuR > 0 ? '+' : ''}${deltaCpuR}`;
                document.getElementById('cpuDeltaR').style.color = deltaCpuR > 0 ? 'blue' : (deltaCpuR < 0 ? 'red' : 'black');

                document.getElementById('playerDeltaR').style.fontSize = '1.3em';
                document.getElementById('cpuDeltaR').style.fontSize = '1.3em';
            }, 1000); 

        }

        // åˆæœŸè¡¨ç¤º
        resetGame();

    </script>
</body>
</html>

