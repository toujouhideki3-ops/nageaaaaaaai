<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¥ å¤ªé¼“ã®é”äºº ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒãƒƒãƒ ğŸ†</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #ff3333; /* ãŠç¥­ã‚Šãƒ¬ãƒƒãƒ‰ */
            --primary-dark: #cc0000;
            --accent-color: #ffcc00;   /* ã‚´ãƒ¼ãƒ«ãƒ‰ */
            --bg-gradient: linear-gradient(135deg, #ff9966 0%, #ff5e62 100%);
            --card-bg: rgba(255, 255, 255, 0.95);
            --text-color: #4a4a4a;
            --shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            background: var(--bg-gradient);
            color: var(--text-color);
            text-align: center;
            padding: 20px;
            margin: 0;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow-x: hidden;
        }

        /* èƒŒæ™¯ã«å’Œé¢¨ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è–„ãå…¥ã‚Œã‚‹ï¼ˆCSSã®ã¿ã§è¡¨ç¾ï¼‰ */
        body::before {
            content: "";
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: radial-gradient(#fff 15%, transparent 16%), radial-gradient(#fff 15%, transparent 16%);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            opacity: 0.1;
            z-index: -1;
            animation: bgScroll 20s linear infinite;
        }

        @keyframes bgScroll {
            from { background-position: 0 0, 10px 10px; }
            to { background-position: 100px 100px, 110px 110px; }
        }

        .screen {
            background: var(--card-bg);
            padding: 40px;
            border-radius: 20px;
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 550px;
            display: none;
            flex-direction: column;
            justify-content: center;
            border: 4px solid #fff;
            
            /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ */
            opacity: 0;
            transform: scale(0.9) translateY(20px);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* å¼¾ã‚€ã‚ˆã†ãªå‹•ã */
        }

        .screen.visible {
            opacity: 1;
            transform: scale(1) translateY(0);
        }

        h1 {
            color: var(--primary-color);
            text-shadow: 2px 2px 0px #ffeebb;
            font-weight: 800;
            margin-bottom: 10px;
            font-size: 1.8em;
        }

        h2 {
            border-bottom: 3px dashed var(--primary-color);
            display: inline-block;
            padding-bottom: 5px;
            margin-bottom: 25px;
            color: #333;
        }
        
        /* ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¡¨ç¤ºï¼ˆãƒ¡ã‚¤ãƒ³ï¼‰ */
        .rating-display {
            font-size: 2em;
            font-weight: 800;
            color: #007bff;
            margin: 20px 0;
            background: #eef;
            padding: 15px;
            border-radius: 15px;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
        }

        /* ç«‹ä½“çš„ãªã‚¢ãƒ¼ã‚±ãƒ¼ãƒ‰é¢¨ãƒœã‚¿ãƒ³ */
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-bottom: 6px solid var(--primary-dark); /* ç«‹ä½“æ„Ÿ */
            padding: 15px 30px;
            margin: 10px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            font-family: 'M PLUS Rounded 1c', sans-serif;
            transition: all 0.1s;
            position: relative;
            top: 0;
        }

        button:hover {
            filter: brightness(1.1);
            transform: translateY(-2px);
        }

        button:active {
            border-bottom-width: 2px;
            transform: translateY(4px); /* æŠ¼ã—è¾¼ã¿ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        }
        
        /* å‹æ•—ãƒœã‚¿ãƒ³ */
        .result-button {
            padding: 20px 30px;
            font-size: 1.3em;
            width: 100%;
            margin: 8px 0;
        }
        #btnWin { background-color: #28a745; border-bottom-color: #1e7e34; }
        #btnLoss { background-color: #dc3545; border-bottom-color: #bd2130; }
        #btnDraw { background-color: #ffc107; color: #444; border-bottom-color: #d39e00; }

        /* æ›²ãƒªã‚¹ãƒˆ */
        .music-list {
            list-style: none;
            padding: 0;
            margin: 20px 0;
            text-align: left;
        }

        .music-list li {
            background: #fff;
            border: 2px solid #eee;
            margin: 8px 0;
            padding: 12px;
            border-radius: 10px;
            font-weight: bold;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }
        
        .music-list li::before {
            content: "â™ª";
            color: var(--primary-color);
            margin-right: 10px;
            font-size: 1.2em;
        }

        .music-list li:hover {
            transform: scale(1.02);
            border-color: var(--accent-color);
        }

        /* ãƒ†ãƒ¼ãƒ–ãƒ«è£…é£¾ */
        .rating-table, .player-detail-table {
            width: 100%;
            margin: 20px auto;
            border-collapse: separate;
            border-spacing: 0;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid #ddd;
        }
        
        .rating-table th, .rating-table td, 
        .player-detail-table th, .player-detail-table td {
            padding: 12px;
            border-bottom: 1px solid #eee;
        }
        
        .rating-table th {
            background-color: var(--primary-color);
            color: white;
        }
        
        .player-detail-table th {
            background: #f8f9fa;
            color: var(--primary-color);
            width: 35%;
        }

        /* çµæœç™ºè¡¨ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ–‡å­— */
        .result-heading-huge {
            font-size: 3em;
            font-weight: 900;
            margin: 10px 0;
            text-shadow: 3px 3px 0px rgba(0,0,0,0.1);
            animation: zoomIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes zoomIn {
            from { transform: scale(0); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .win-text { color: #28a745; text-shadow: 0 0 10px #7aff96; }
        .lose-text { color: #dc3545; }
        .draw-text { color: #ffc107; text-shadow: 2px 2px 0px #444; }

        /* ãƒ¬ãƒ¼ãƒˆå¤‰å‹•ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ */
        .delta-rate-change {
            font-weight: 800;
            display: inline-block;
        }

        /* å¾…æ©Ÿä¸­ã®ãƒ‘ãƒ«ã‚¹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .pulse-text {
            animation: pulse 1.5s infinite;
            color: #1DA1F2;
            font-weight: bold;
        }
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; transform: scale(1.05); }
            100% { opacity: 0.6; }
        }
    </style>
</head>
<body>

    <div id="titleScreen" class="screen">
        <h1>ğŸ¥ å¤ªé¼“ã®é”äºº<br>ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒãƒƒãƒ ğŸ†</h1>
        <div class="rating-display">
            RATING: <span id="playerRatingDisplay">1500</span>
        </div>
        <p>å®ŸåŠ›ãŒè¿‘ã„ç›¸æ‰‹ã¨ãƒãƒƒãƒãƒ³ã‚°ã—ã€<br>ãƒªã‚¶ãƒ«ãƒˆäº¤æ›ã§ãƒ¬ãƒ¼ãƒˆã‚’ç«¶ãŠã†ï¼</p>
        
        <div style="margin-top: 20px;">
            <button onclick="startMatch('online')">âš”ï¸ ãƒãƒƒãƒãƒ³ã‚°é–‹å§‹ (å¯¾äºº)</button>
            <button onclick="startMatch('cpu')" style="background-color:#6c757d; border-bottom-color:#545b62;">ğŸ¤– CPUã¨ç·´ç¿’ (ãƒ†ã‚¹ãƒˆ)</button>
        </div>
    </div>

    <div id="matchResultScreen" class="screen">
        <h2 style="color: #28a745;">ğŸ‰ ãƒãƒƒãƒãƒ³ã‚°æˆç«‹ï¼</h2>
        
        <table class="player-detail-table">
            <tr>
                <th>ã‚ãªãŸ (Player)</th>
                <td id="myInfoDisplay"></td>
            </tr>
            <tr>
                <th>å¯¾æˆ¦ç›¸æ‰‹ (Rival)</th>
                <td id="opponentInfo"></td>
            </tr>
        </table>

        <h3>ğŸ“‚ ä»Šæ—¥ã®èª²é¡Œæ›² (3æ›²)</h3>
        <ul id="selectedSongs" class="music-list">
            </ul>
        <button onclick="goToResultSubmission()">ãƒªã‚¶ãƒ«ãƒˆäº¤æ›ãƒ»çµæœç”³å‘Šã¸ â¡</button>
    </div>

    <div id="resultSubmissionScreen" class="screen">
        <h2>ğŸ—³ï¸ å‹æ•—ã®ç”³å‘Š</h2>
        <p>ãƒªã‚¶ãƒ«ãƒˆç”»åƒã‚’äº¤æ›ã—ã€<br><strong>3æ›²åˆè¨ˆã®è‰¯ã®æ•°</strong>ã§å‹æ•—ã‚’æ±ºã‚ã¦ãã ã•ã„ã€‚</p>
        
        <div style="background:#f0f8ff; padding:10px; border-radius:10px; margin: 15px 0;">
            <span style="font-size:0.9em; color:#666;">å¯¾æˆ¦ç›¸æ‰‹</span><br>
            <span id="opponentDisplayInSubmission" style="font-size: 1.4em; font-weight: 800; color: #1DA1F2;"></span>
        </div>
        
        <h3 style="margin-top: 20px; font-size:1.1em;">ä»Šå›ã®èª²é¡Œæ›²</h3>
        <ul id="submissionSongs" class="music-list" style="font-size: 0.9em;">
             </ul>

        <div style="margin-top: 20px;">
            <p style="font-weight:bold; margin-bottom:10px;">ã‚ãªãŸã®çµæœã¯ï¼Ÿ</p>
            <div style="display:flex; gap:10px;">
                <button id="btnWin" class="result-button" onclick="submitResult(1)">ğŸ† å‹åˆ© (Win)</button>
                <button id="btnLoss" class="result-button" onclick="submitResult(0)">ğŸ’€ æ•—åŒ— (Lose)</button>
            </div>
            <button id="btnDraw" class="result-button" style="margin-top:0;" onclick="submitResult(0.5)">ğŸ¤ å¼•ãåˆ†ã‘ (Draw)</button>
        </div>
    </div>
    
    <div id="waitingScreen" class="screen" style="text-align: center;">
        <h2>â³ ç›¸æ‰‹ã®ç”³å‘Šå¾…ã¡...</h2>
        <div style="margin: 40px 0;">
            <p class="pulse-text" style="font-size: 3em;">ğŸ¥</p>
            <p style="font-size: 1.2em;">ç›¸æ‰‹ï¼ˆ<span id="waitingRivalName" style="color: #1DA1F2; font-weight:bold;"></span>ï¼‰ãŒ<br>çµæœã‚’å…¥åŠ›ã—ã¦ã„ã¾ã™ã€‚</p>
        </div>
        
        <div style="margin-top: 30px;">
            <button onclick="resetGame()" style="background:#999; border-bottom-color:#777; font-size:0.9em;">ã‚¿ã‚¤ãƒˆãƒ«ã«æˆ»ã‚‹ (å¼·åˆ¶ä¸­æ–­)</button>
        </div>
    </div>

    <div id="resultScreen" class="screen">
        <div id="resultHeading" class="result-heading-huge"></div>
        <p>ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨ˆç®—å®Œäº†ï¼</p>
        
        <table class="rating-table">
            <thead>
                <tr>
                    <th>PLAYER</th>
                    <th>æ—§ãƒ¬ãƒ¼ãƒˆ</th>
                    <th>æ¨ç§»</th>
                    <th>æ–°ãƒ¬ãƒ¼ãƒˆ</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td style="font-weight:bold;">ã‚ãªãŸ</td>
                    <td id="playerOldR"></td>
                    <td>â¡</td>
                    <td style="font-size:1.4em; font-weight:800;" id="playerNewR"></td>
                </tr>
                <tr>
                    <td>RIVAL</td>
                    <td id="cpuOldR"></td>
                    <td>â¡</td>
                    <td id="cpuNewR"></td>
                </tr>
            </tbody>
        </table>
        
        <div style="margin: 20px 0; font-size: 2em; font-weight: 800;">
            <span id="diffDisplay"></span>
        </div>

        <button onclick="resetGame()">ğŸ  ã‚¿ã‚¤ãƒˆãƒ«ã«æˆ»ã‚‹</button>
    </div>


    <script>
        // --- è¨­å®šå€¤ã¨åˆæœŸãƒ‡ãƒ¼ã‚¿ ---
        const SONG_POOL = [
            "Infinite Rebellion", "å½ï¼ˆè£ï¼‰", "CRUXNAUT", "The Future of the å¤ªé¼“ãƒ‰ãƒ©ãƒ ï¼ˆè£ï¼‰", 
            "ç¥ç«œ ï½Shinryuï½ï¼ˆè£ï¼‰", "æ†æ‚ªã¨é†œæ‚ªã®èŠ±æŸï¼ˆè£ï¼‰", "ãƒ€ãƒ¼ã‚¯ãƒ»ã‚¨ã‚¯ã‚¹ãƒ»ãƒã‚­ãƒŠâ™¡", 
            "ç¬¬å…­å¤©é­”ç‹ï¼ˆè¡¨ï¼‰", "ç¬¬å…­å¤©é­”ç‹ï¼ˆè£ï¼‰", "ãƒ€ãƒ³ã‚¬ãƒ³ãƒãƒ¼ãƒ„ï¼ˆè£ï¼‰", "Destination 2F29", 
            "ãƒ‰ãƒ³ã‚«ãƒ2000", "23æ™‚54åˆ†ã€é™½ã®æ—…è·¯ã¸ã®ãƒ—ãƒ¬ãƒªãƒ¥ãƒ¼ãƒ‰ï¼ˆè£ï¼‰", "Vixtoryï¼ˆè£ï¼‰", 
            "vs.VIGVANGSï¼ˆè£ï¼‰", "poxeiâ™¦DOON", "å¹½ç„ãƒä¹±"
        ];
        const K_FACTOR = 32;
        const INITIAL_RATING = 1500;
        const SIMULATION_DELAY_MS = 4000; 

        // --- ã‚²ãƒ¼ãƒ ã‚¹ãƒ†ãƒ¼ãƒˆ ---
        let playerRating = INITIAL_RATING;
        let cpuRating = INITIAL_RATING;
        let opponentXId = '';
        const PLAYER_ID = "@Taitasuuuu11"; 
        let playerReportedResult = null;
        let opponentReportedResult = null;

        // --- ç”»é¢é·ç§»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ ---
        function showScreen(screenId) {
            // ç¾åœ¨ã®è¡¨ç¤ºã‚’æ¶ˆã™
            document.querySelectorAll('.screen').forEach(el => {
                el.classList.remove('visible');
                setTimeout(() => {
                    if(!el.classList.contains('visible')) el.style.display = 'none';
                }, 400); // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆå¾…ã¡
            });

            // å°‘ã—å¾…ã£ã¦ã‹ã‚‰æ¬¡ã‚’è¡¨ç¤ºï¼ˆé·ç§»ã‚’æ»‘ã‚‰ã‹ã«ï¼‰
            setTimeout(() => {
                const targetScreen = document.getElementById(screenId);
                targetScreen.style.display = 'flex';
                // ãƒªãƒ•ãƒ­ãƒ¼ã‚’å¼·åˆ¶ã—ã¦ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç™ºç«
                void targetScreen.offsetWidth;
                targetScreen.classList.add('visible'); 
            }, 200);
        }

        // ãƒ©ãƒ³ãƒ€ãƒ IDç”Ÿæˆ
        function generateRandomXId(isCPU) {
            if (isCPU) {
                const cpuNames = ["DON-Chan", "KATSU-Kun", "TaikoMaster", "DrumKing"];
                const suffix = Math.floor(Math.random() * 900) + 100;
                return `@${cpuNames[Math.floor(Math.random() * cpuNames.length)]}_${suffix}`;
            }
            return "@Rival_" + Math.random().toString(36).substring(2, 6).toUpperCase();
        }

        function resetGame() {
            playerReportedResult = null;
            opponentReportedResult = null;
            document.getElementById('playerRatingDisplay').textContent = Math.round(playerRating);
            
            // åˆå›ãƒ­ãƒ¼ãƒ‰æ™‚ã¯å³æ™‚è¡¨ç¤ºã€ãã‚Œä»¥å¤–ã¯ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
            const title = document.getElementById('titleScreen');
            if(title.style.display === '') {
                 title.style.display = 'flex';
                 setTimeout(() => title.classList.add('visible'), 10);
            } else {
                showScreen('titleScreen');
            }
        }

        function selectRandomSongs(count) {
            const shuffled = [...SONG_POOL].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count);
        }

        // --- Eloè¨ˆç®— ---
        function calculateExpectedScore(Ra, Rb) {
            return 1.0 / (1.0 + Math.pow(10, (Rb - Ra) / 400));
        }

        function updateRating(R, E, S, K) {
            return R + K * (S - E);
        }

        // --- ã‚²ãƒ¼ãƒ ãƒ•ãƒ­ãƒ¼ ---
        function startMatch(mode) {
            cpuRating = INITIAL_RATING + Math.floor(Math.random() * 300) - 150; 
            const isCPU = (mode === 'cpu');
            opponentXId = generateRandomXId(isCPU);

            document.getElementById('myInfoDisplay').innerHTML = 
                `<span style="color:#007bff; font-weight:bold;">${PLAYER_ID}</span><br>Rating: ${Math.round(playerRating)}`;
            document.getElementById('opponentInfo').innerHTML = 
                `<span style="color:#e44d26; font-weight:bold;">${opponentXId}</span><br>Rating: ${Math.round(cpuRating)}`;

            selectedSongs = selectRandomSongs(3);
            const songListElement = document.getElementById('selectedSongs');
            songListElement.innerHTML = '';
            selectedSongs.forEach((song, index) => {
                const li = document.createElement('li');
                li.innerHTML = `<span style="color:#999; margin-right:5px;">#${index+1}</span> ${song}`;
                li.style.animation = `fadeIn 0.5s ease forwards ${index * 0.1}s`;
                li.style.opacity = '0'; // åˆæœŸçŠ¶æ…‹
                songListElement.appendChild(li);
            });
            
            // CSSã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾©ã®è¿½åŠ ï¼ˆJSå†…ã§å®šç¾©ã—ã¦æ³¨å…¥ï¼‰
            const styleSheet = document.createElement("style");
            styleSheet.innerText = "@keyframes fadeIn { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }";
            document.head.appendChild(styleSheet);

            showScreen('matchResultScreen');
        }

        function goToResultSubmission() {
            const submissionList = document.getElementById('submissionSongs');
            submissionList.innerHTML = '';
            selectedSongs.forEach((song, index) => {
                const li = document.createElement('li');
                li.textContent = song;
                submissionList.appendChild(li);
            });
            document.getElementById('opponentDisplayInSubmission').textContent = opponentXId;
            showScreen('resultSubmissionScreen');
        }

        function submitResult(pResult) {
            let resultAction = pResult === 1 ? "å‹åˆ©" : (pResult === 0 ? "æ•—åŒ—" : "å¼•ãåˆ†ã‘");
            if (!confirm(`å¯¾æˆ¦çµæœã€Œ${resultAction}ã€ã§ç¢ºå®šã—ã¾ã™ã‹ï¼Ÿ`)) return;

            playerReportedResult = pResult;
            document.getElementById('waitingRivalName').textContent = opponentXId;
            showScreen('waitingScreen');
            simulateCpuSubmission(pResult);
        }
        
        function simulateCpuSubmission(playerResult) {
            // é…å»¶æ¼”å‡º
            setTimeout(() => {
                let cpuResult;
                if (playerResult === 1) cpuResult = 0;
                else if (playerResult === 0) cpuResult = 1;
                else cpuResult = 0.5;
                
                opponentReportedResult = cpuResult;
                checkResultsAndCalculate();
            }, SIMULATION_DELAY_MS);
        }

        function checkResultsAndCalculate() {
            if (playerReportedResult === null || opponentReportedResult === null) {
                resetGame(); return;
            }

            const resultSum = playerReportedResult + opponentReportedResult;
            if (resultSum !== 1.0) {
                 alert("ã‚¨ãƒ©ãƒ¼ï¼šç”³å‘Šå†…å®¹ã«çŸ›ç›¾ãŒã‚ã‚Šã¾ã™ã€‚");
                 resetGame();
                 return;
            }
            
            let finalPlayerResult = playerReportedResult; 
            let resultText = "", resultClass = "";

            if (finalPlayerResult === 1) {
                resultText = "YOU WIN!!";
                resultClass = "win-text";
            } else if (finalPlayerResult === 0) {
                resultText = "LOSE...";
                resultClass = "lose-text";
            } else {
                resultText = "DRAW";
                resultClass = "draw-text";
            }

            calculateAndDisplayRating(finalPlayerResult, resultText, resultClass);
        }
        
        // --- æ•°å­—ã®ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—æ¼”å‡º ---
        function animateValue(id, start, end, duration) {
            const obj = document.getElementById(id);
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                obj.innerHTML = Math.floor(progress * (end - start) + start);
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        function calculateAndDisplayRating(pResult, rText, rClass) {
            const expectedPlayerScore = calculateExpectedScore(playerRating, cpuRating);
            const expectedCpuScore = calculateExpectedScore(cpuRating, playerRating); 
            const oldPlayerR = playerRating;
            const oldCpuR = cpuRating;
            const newPlayerR = updateRating(oldPlayerR, expectedPlayerScore, pResult, K_FACTOR);
            const newCpuR = updateRating(oldCpuR, expectedCpuScore, 1 - pResult, K_FACTOR);
            const deltaPlayerR = Math.round(newPlayerR - oldPlayerR);
            
            playerRating = newPlayerR;
            cpuRating = newCpuR;
            
            const resultHeading = document.getElementById('resultHeading');
            resultHeading.textContent = rText;
            resultHeading.className = "result-heading-huge " + rClass;

            document.getElementById('playerOldR').textContent = Math.round(oldPlayerR);
            document.getElementById('cpuOldR').textContent = Math.round(oldCpuR);
            
            // å·®åˆ†ã®è¡¨ç¤ºè‰²
            const diffEl = document.getElementById('diffDisplay');
            if(deltaPlayerR > 0) {
                diffEl.textContent = `+${deltaPlayerR}`;
                diffEl.style.color = 'blue';
            } else if (deltaPlayerR < 0) {
                diffEl.textContent = `${deltaPlayerR}`;
                diffEl.style.color = 'red';
            } else {
                diffEl.textContent = `Â±0`;
                diffEl.style.color = '#777';
            }

            showScreen('resultScreen');

            // ç”»é¢é·ç§»å¾Œã«æ•°å­—ã‚’ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ã•ã›ã‚‹
            setTimeout(() => {
                animateValue("playerNewR", Math.round(oldPlayerR), Math.round(newPlayerR), 1500);
                animateValue("cpuNewR", Math.round(oldCpuR), Math.round(newCpuR), 1500);
            }, 500);
        }

        // åˆæœŸåŒ–
        document.addEventListener("DOMContentLoaded", () => {
             // æœ€åˆã®ç”»é¢ã‚’è¡¨ç¤º
             document.getElementById('titleScreen').style.display = 'flex';
             setTimeout(()=>document.getElementById('titleScreen').classList.add('visible'), 100);
        });

    </script>
</body>
</html>
